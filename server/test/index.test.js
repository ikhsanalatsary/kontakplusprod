'use strict';

var _mongoose = require('mongoose');

var _mongoose2 = _interopRequireDefault(_mongoose);

var _chai = require('chai');

var _supertest = require('supertest');

var _supertest2 = _interopRequireDefault(_supertest);

var _btoa = require('btoa');

var _btoa2 = _interopRequireDefault(_btoa);

var _Faker = require('Faker');

var _Faker2 = _interopRequireDefault(_Faker);

var _titlegen = require('titlegen');

var _titlegen2 = _interopRequireDefault(_titlegen);

var _config = require('../config');

var _config2 = _interopRequireDefault(_config);

var _contacts = require('../model/contacts.model');

var _contacts2 = _interopRequireDefault(_contacts);

var _config3 = require('../config/config.json');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

_mongoose2.default.Promise = global.Promise;
_mongoose2.default.connect(_config2.default.getDbConnection());

describe('Routing', function () {
  var base64Str = (0, _btoa2.default)(_config3.admin.user + ':' + _config3.admin.password);
  var url = 'http://localhost:3000';
  var api = 'http://localhost:3000/api/contacts';
  var headers = {
    authorization: {
      Authorization: 'Basic ' + base64Str,
      Accept: 'application/json'
    },
    unauthorization: {
      'WWW-Authenticate': 'Basic realm=Authorization Required'
    }
  };

  var generator = _titlegen2.default.create();
  generator.feed(['My Love', 'Soulmate', 'My Boss', 'My Partner', 'My Teacher', 'My Mentor', 'My Big Brother', 'My Mom', 'My Dad']);

  var gentype = _titlegen2.default.create();
  gentype.feed(['Mobile', 'Work', 'Home']);

  var etype = _titlegen2.default.create();
  etype.feed(['Personal', 'Work', 'Other']);

  var adrtype = _titlegen2.default.create();
  adrtype.feed(['Home', 'Work', 'Other']);

  var contactTitle = generator.next();
  var option = gentype.next();
  var option2 = etype.next();
  var option3 = adrtype.next();
  var contact = {
    name: _Faker2.default.Name.findName(),
    title: contactTitle,
    email: [{ option: option2, email: _Faker2.default.Internet.email() }, { option: option2, email: _Faker2.default.Internet.email() }],
    phone: [{ option: option, number: _Faker2.default.PhoneNumber.phoneNumber() }, { option: option, number: _Faker2.default.PhoneNumber.phoneNumber() }],
    address: [{ option: option3, address: _Faker2.default.Address.streetAddress() }, { option: option3, address: _Faker2.default.Address.streetAddress() }],
    company: _Faker2.default.Company.companyName(),
    favorite: false
  };

  describe("GET '/'", function () {
    it('should get status code 200 with no auth', function (done) {
      (0, _supertest2.default)(url).get('/').set('Accept', 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8').expect(200, done);
    });
  });

  describe("GET '/api' that not actually route", function () {
    it('should get status 404', function (done) {
      (0, _supertest2.default)(url).get('/api').expect('Content-Type', 'text/html; charset=utf-8').expect(404, done);
    });

    describe("GET '/api/contacts'", function () {
      it('should get status 200 if Authorized and return Array-JSON', function (done) {
        (0, _supertest2.default)(api).get('/').set(headers.authorization).expect('Content-Type', /json/).expect(200).end(function (err, res) {
          if (err) done(err);
          (0, _chai.expect)(res.body).to.be.instanceof(Array);
          done();
        });
      });
    });

    describe("GET '/api/contacts/:id'", function () {
      it('should get status 200 if Authorized and return Object-json', function (done) {
        var newContact = new _contacts2.default(contact);
        var promise = newContact.save();
        promise.then(function (person) {
          if (person) {
            (0, _supertest2.default)(api).get('/' + person.id).set(headers.authorization).expect('Content-Type', /json/).expect(200).end(function (err, res) {
              if (err) done(err);
              (0, _chai.expect)(res.body).to.be.an('object');
              (0, _chai.expect)(res.body).to.have.property('name');
              (0, _chai.expect)(res.body).to.have.property('title');
              (0, _chai.expect)(res.body).to.have.property('email');
              (0, _chai.expect)(res.body).to.have.property('phone');
              (0, _chai.expect)(res.body).to.have.property('address');
              (0, _chai.expect)(res.body).to.have.property('company');
              (0, _chai.expect)(res.body).to.have.property('_id').to.equal(person.id);
              done();
            });
          }
        }).catch(function (err) {
          done(err);
        });
      });
    });
  });

  describe("POST '/api/contacts'", function () {
    it('should post and get response status 200', function (done) {
      (0, _supertest2.default)(api).post('/').set(headers.authorization).send(contact).expect(200).end(function (err, res) {
        if (err) done(err);
        (0, _chai.expect)(res.body).to.be.an('object');
        done();
      });
    });

    describe('upload image', function () {
      it('should get status 200 response', function (done) {
        (0, _supertest2.default)(api).post('/upload').set(headers.authorization).attach('avatar', '/Users/adi/Desktop/nodejs-512.png').end(function (err, res) {
          if (err) done(err);
          (0, _chai.expect)(res.status).to.equal(200);
          done();
        });
      });
    });
  });

  describe("PUT '/api/contacts/:id'", function () {
    it('should get status 200 if Authorized', function (done) {
      var newContact = new _contacts2.default(contact);
      var promise = newContact.save();
      promise.then(function (person) {
        if (person) {
          var body = {};
          body.name = 'Jhonny Depp put';
          body.company = 'Hollywood';
          body.title = 'Actress';
          var newPerson = Object.assign(person, body);
          (0, _supertest2.default)(api).put('/' + person.id).set(headers.authorization).send(newPerson).expect('Content-Type', /json/).expect(200).end(function (err, res) {
            if (err) done(err);
            (0, _chai.expect)(res.body).to.be.an('object');
            (0, _chai.expect)(res.body).to.have.property('name').to.equal('Jhonny Depp put');
            (0, _chai.expect)(res.body).to.have.property('title');
            (0, _chai.expect)(res.body).to.have.property('email');
            (0, _chai.expect)(res.body).to.have.property('phone');
            (0, _chai.expect)(res.body).to.have.property('address');
            (0, _chai.expect)(res.body).to.have.property('company');
            (0, _chai.expect)(res.body).to.have.property('_id').to.equal(person.id);
            done();
          });
        }
      }).catch(function (err) {
        done(err);
      });
    });
  });

  describe("PATCH '/api/contacts/:id'", function () {
    it('should get status 200 if Authorized', function (done) {
      var newContact = new _contacts2.default(contact);
      var promise = newContact.save();
      promise.then(function (person) {
        if (person) {
          var body = {};
          body.favorite = true;
          body.name = 'patch';
          var newPerson = Object.assign(person, body);
          (0, _supertest2.default)(api).patch('/' + person.id).set(headers.authorization).send(newPerson).expect(200).end(function (err, res) {
            if (err) done(err);
            (0, _chai.expect)(res.body).to.be.an('object');
            (0, _chai.expect)(res.body).to.have.property('name').to.equal('patch');
            (0, _chai.expect)(res.body).to.have.property('favorite').to.equal(true);
            done();
          });
        }
      }).catch(function (err) {
        done(err);
      });
    });
  });

  describe("DELETE '/api/contacts/:id'", function () {
    it('should get status 200 if Authorized', function (done) {
      var newContact = new _contacts2.default(contact);
      var promise = newContact.save();
      promise.then(function (person) {
        if (person) {
          (0, _supertest2.default)(api).delete('/' + person.id).set(headers.authorization).expect(200, done);
        }
      }).catch(function (err) {
        done(err);
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NlcnZlci90ZXN0L2luZGV4LnRlc3QuanMiXSwibmFtZXMiOlsiUHJvbWlzZSIsImdsb2JhbCIsImNvbm5lY3QiLCJnZXREYkNvbm5lY3Rpb24iLCJkZXNjcmliZSIsImJhc2U2NFN0ciIsInVzZXIiLCJwYXNzd29yZCIsInVybCIsImFwaSIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwiQXV0aG9yaXphdGlvbiIsIkFjY2VwdCIsInVuYXV0aG9yaXphdGlvbiIsImdlbmVyYXRvciIsImNyZWF0ZSIsImZlZWQiLCJnZW50eXBlIiwiZXR5cGUiLCJhZHJ0eXBlIiwiY29udGFjdFRpdGxlIiwibmV4dCIsIm9wdGlvbiIsIm9wdGlvbjIiLCJvcHRpb24zIiwiY29udGFjdCIsIm5hbWUiLCJOYW1lIiwiZmluZE5hbWUiLCJ0aXRsZSIsImVtYWlsIiwiSW50ZXJuZXQiLCJwaG9uZSIsIm51bWJlciIsIlBob25lTnVtYmVyIiwicGhvbmVOdW1iZXIiLCJhZGRyZXNzIiwiQWRkcmVzcyIsInN0cmVldEFkZHJlc3MiLCJjb21wYW55IiwiQ29tcGFueSIsImNvbXBhbnlOYW1lIiwiZmF2b3JpdGUiLCJpdCIsImRvbmUiLCJnZXQiLCJzZXQiLCJleHBlY3QiLCJlbmQiLCJlcnIiLCJyZXMiLCJib2R5IiwidG8iLCJiZSIsImluc3RhbmNlb2YiLCJBcnJheSIsIm5ld0NvbnRhY3QiLCJwcm9taXNlIiwic2F2ZSIsInRoZW4iLCJwZXJzb24iLCJpZCIsImFuIiwiaGF2ZSIsInByb3BlcnR5IiwiZXF1YWwiLCJjYXRjaCIsInBvc3QiLCJzZW5kIiwiYXR0YWNoIiwic3RhdHVzIiwibmV3UGVyc29uIiwiT2JqZWN0IiwiYXNzaWduIiwicHV0IiwicGF0Y2giLCJkZWxldGUiXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7QUFDQTs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUVBLG1CQUFTQSxPQUFU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b0JXLElBQXBCLENBQXlCQyxRQUF6QixDQUFrQyxVQUFsQyxFQUE4Q1osRUFBOUMsQ0FBaURhLEtBQWpELENBQXVELElBQXZEO0FBQ0FyQjtBQUNELFdBWEg7QUFZRDtBQUNGLE9BbkJELEVBb0JDc0IsS0FwQkQsQ0FvQk8sVUFBQ2pCLEdBQUQsRUFBUztBQUNkTCxhQUFLSyxHQUFMO0FBQ0QsT0F0QkQ7QUF1QkQsS0ExQkQ7QUEyQkQsR0E1QkQ7O0FBOEJBOUMsV0FBUyw0QkFBVCxFQUF1QyxZQUFNO0FBQzNDd0MsT0FBRyxxQ0FBSCxFQUEwQyxVQUFDQyxJQUFELEVBQVU7QUFDbEQsVUFBTVksYUFBYSx1QkFBWS9CLE9BQVosQ0FBbkI7QUFDQSxVQUFNZ0MsVUFBVUQsV0FBV0UsSUFBWCxFQUFoQjtBQUNBRCxjQUFRRSxJQUFSLENBQWEsVUFBQ0MsTUFBRCxFQUFZO0FBQ3ZCLFlBQUlBLE1BQUosRUFBWTtBQUNWLG1DQUFRcEQsR0FBUixFQUNHb0UsTUFESCxPQUNjaEIsT0FBT0MsRUFEckIsRUFFR2YsR0FGSCxDQUVPckMsUUFBUUMsYUFGZixFQUdHcUMsTUFISCxDQUdVLEdBSFYsRUFHZUgsSUFIZjtBQUlEO0FBQ0YsT0FQRCxFQVFDc0IsS0FSRCxDQVFPLFVBQUNqQixHQUFELEVBQVM7QUFDZEwsYUFBS0ssR0FBTDtBQUNELE9BVkQ7QUFXRCxLQWREO0FBZUQsR0FoQkQ7QUFpQkQsQ0F4UEQiLCJmaWxlIjoiaW5kZXgudGVzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtb25nb29zZSBmcm9tICdtb25nb29zZSc7XG5pbXBvcnQgeyBleHBlY3QgfSBmcm9tICdjaGFpJztcbmltcG9ydCByZXF1ZXN0IGZyb20gJ3N1cGVydGVzdCc7XG5pbXBvcnQgYnRvYSBmcm9tICdidG9hJztcbmltcG9ydCBmYWtlciBmcm9tICdGYWtlcic7XG5pbXBvcnQgdGl0bGVnZW4gZnJvbSAndGl0bGVnZW4nO1xuaW1wb3J0IGNvbmZpZyBmcm9tICcuLi9jb25maWcnO1xuaW1wb3J0IENvbnRhY3QgZnJvbSAnLi4vbW9kZWwvY29udGFjdHMubW9kZWwnO1xuaW1wb3J0IHsgYWRtaW4gfSBmcm9tICcuLi9jb25maWcvY29uZmlnLmpzb24nO1xuXG5tb25nb29zZS5Qcm9taXNlID0gZ2xvYmFsLlByb21pc2U7XG5tb25nb29zZS5jb25uZWN0KGNvbmZpZy5nZXREYkNvbm5lY3Rpb24oKSk7XG5cbmRlc2NyaWJlKCdSb3V0aW5nJywgKCkgPT4ge1xuICBjb25zdCBiYXNlNjRTdHIgPSBidG9hKGAke2FkbWluLnVzZXJ9OiR7YWRtaW4ucGFzc3dvcmR9YCk7XG4gIGNvbnN0IHVybCA9ICdodHRwOi8vbG9jYWxob3N0OjMwMDAnO1xuICBjb25zdCBhcGkgPSAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9jb250YWN0cyc7XG4gIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgYXV0aG9yaXphdGlvbjoge1xuICAgICAgQXV0aG9yaXphdGlvbjogYEJhc2ljICR7YmFzZTY0U3RyfWAsXG4gICAgICBBY2NlcHQ6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICB9LFxuICAgIHVuYXV0aG9yaXphdGlvbjoge1xuICAgICAgJ1dXVy1BdXRoZW50aWNhdGUnOiAnQmFzaWMgcmVhbG09QXV0aG9yaXphdGlvbiBSZXF1aXJlZCcsXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCBnZW5lcmF0b3IgPSB0aXRsZWdlbi5jcmVhdGUoKTtcbiAgZ2VuZXJhdG9yLmZlZWQoW1xuICAgICdNeSBMb3ZlJyxcbiAgICAnU291bG1hdGUnLFxuICAgICdNeSBCb3NzJyxcbiAgICAnTXkgUGFydG5lcicsXG4gICAgJ015IFRlYWNoZXInLFxuICAgICdNeSBNZW50b3InLFxuICAgICdNeSBCaWcgQnJvdGhlcicsXG4gICAgJ015IE1vbScsXG4gICAgJ015IERhZCcsXG4gIF0pO1xuXG4gIGNvbnN0IGdlbnR5cGUgPSB0aXRsZWdlbi5jcmVhdGUoKTtcbiAgZ2VudHlwZS5mZWVkKFtcbiAgICAnTW9iaWxlJyxcbiAgICAnV29yaycsXG4gICAgJ0hvbWUnLFxuICBdKTtcblxuICBjb25zdCBldHlwZSA9IHRpdGxlZ2VuLmNyZWF0ZSgpO1xuICBldHlwZS5mZWVkKFtcbiAgICAnUGVyc29uYWwnLFxuICAgICdXb3JrJyxcbiAgICAnT3RoZXInLFxuICBdKTtcblxuICBjb25zdCBhZHJ0eXBlID0gdGl0bGVnZW4uY3JlYXRlKCk7XG4gIGFkcnR5cGUuZmVlZChbXG4gICAgJ0hvbWUnLFxuICAgICdXb3JrJyxcbiAgICAnT3RoZXInLFxuICBdKTtcblxuICBjb25zdCBjb250YWN0VGl0bGUgPSBnZW5lcmF0b3IubmV4dCgpO1xuICBjb25zdCBvcHRpb24gPSBnZW50eXBlLm5leHQoKTtcbiAgY29uc3Qgb3B0aW9uMiA9IGV0eXBlLm5leHQoKTtcbiAgY29uc3Qgb3B0aW9uMyA9IGFkcnR5cGUubmV4dCgpO1xuICBjb25zdCBjb250YWN0ID0ge1xuICAgIG5hbWU6IGZha2VyLk5hbWUuZmluZE5hbWUoKSxcbiAgICB0aXRsZTogY29udGFjdFRpdGxlLFxuICAgIGVtYWlsOiBbXG4gICAgICB7IG9wdGlvbjogb3B0aW9uMiwgZW1haWw6IGZha2VyLkludGVybmV0LmVtYWlsKCkgfSxcbiAgICAgIHsgb3B0aW9uOiBvcHRpb24yLCBlbWFpbDogZmFrZXIuSW50ZXJuZXQuZW1haWwoKSB9LFxuICAgIF0sXG4gICAgcGhvbmU6IFtcbiAgICAgIHsgb3B0aW9uLCBudW1iZXI6IGZha2VyLlBob25lTnVtYmVyLnBob25lTnVtYmVyKCkgfSxcbiAgICAgIHsgb3B0aW9uLCBudW1iZXI6IGZha2VyLlBob25lTnVtYmVyLnBob25lTnVtYmVyKCkgfSxcbiAgICBdLFxuICAgIGFkZHJlc3M6IFtcbiAgICAgIHsgb3B0aW9uOiBvcHRpb24zLCBhZGRyZXNzOiBmYWtlci5BZGRyZXNzLnN0cmVldEFkZHJlc3MoKSB9LFxuICAgICAgeyBvcHRpb246IG9wdGlvbjMsIGFkZHJlc3M6IGZha2VyLkFkZHJlc3Muc3RyZWV0QWRkcmVzcygpIH0sXG4gICAgXSxcbiAgICBjb21wYW55OiBmYWtlci5Db21wYW55LmNvbXBhbnlOYW1lKCksXG4gICAgZmF2b3JpdGU6IGZhbHNlLFxuICB9O1xuXG4gIGRlc2NyaWJlKFwiR0VUICcvJ1wiLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZXQgc3RhdHVzIGNvZGUgMjAwIHdpdGggbm8gYXV0aCcsIChkb25lKSA9PiB7XG4gICAgICByZXF1ZXN0KHVybClcbiAgICAgICAgLmdldCgnLycpXG4gICAgICAgIC5zZXQoJ0FjY2VwdCcsICd0ZXh0L2h0bWwsYXBwbGljYXRpb24veGh0bWwreG1sLGFwcGxpY2F0aW9uL3htbDtxPTAuOSxpbWFnZS93ZWJwLCovKjtxPTAuOCcpXG4gICAgICAgIC5leHBlY3QoMjAwLCBkb25lKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJHRVQgJy9hcGknIHRoYXQgbm90IGFjdHVhbGx5IHJvdXRlXCIsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCBzdGF0dXMgNDA0JywgKGRvbmUpID0+IHtcbiAgICAgIHJlcXVlc3QodXJsKVxuICAgICAgICAuZ2V0KCcvYXBpJylcbiAgICAgICAgLmV4cGVjdCgnQ29udGVudC1UeXBlJywgJ3RleHQvaHRtbDsgY2hhcnNldD11dGYtOCcpXG4gICAgICAgIC5leHBlY3QoNDA0LCBkb25lKTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKFwiR0VUICcvYXBpL2NvbnRhY3RzJ1wiLCAoKSA9PiB7XG4gICAgICBpdCgnc2hvdWxkIGdldCBzdGF0dXMgMjAwIGlmIEF1dGhvcml6ZWQgYW5kIHJldHVybiBBcnJheS1KU09OJywgKGRvbmUpID0+IHtcbiAgICAgICAgcmVxdWVzdChhcGkpXG4gICAgICAgICAgLmdldCgnLycpXG4gICAgICAgICAgLnNldChoZWFkZXJzLmF1dGhvcml6YXRpb24pXG4gICAgICAgICAgLmV4cGVjdCgnQ29udGVudC1UeXBlJywgL2pzb24vKVxuICAgICAgICAgIC5leHBlY3QoMjAwKVxuICAgICAgICAgIC5lbmQoKGVyciwgcmVzKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyKSBkb25lKGVycik7XG4gICAgICAgICAgICBleHBlY3QocmVzLmJvZHkpLnRvLmJlLmluc3RhbmNlb2YoQXJyYXkpO1xuICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZShcIkdFVCAnL2FwaS9jb250YWN0cy86aWQnXCIsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgZ2V0IHN0YXR1cyAyMDAgaWYgQXV0aG9yaXplZCBhbmQgcmV0dXJuIE9iamVjdC1qc29uJywgKGRvbmUpID0+IHtcbiAgICAgICAgY29uc3QgbmV3Q29udGFjdCA9IG5ldyBDb250YWN0KGNvbnRhY3QpO1xuICAgICAgICBjb25zdCBwcm9taXNlID0gbmV3Q29udGFjdC5zYXZlKCk7XG4gICAgICAgIHByb21pc2UudGhlbigocGVyc29uKSA9PiB7XG4gICAgICAgICAgaWYgKHBlcnNvbikge1xuICAgICAgICAgICAgcmVxdWVzdChhcGkpXG4gICAgICAgICAgICAgIC5nZXQoYC8ke3BlcnNvbi5pZH1gKVxuICAgICAgICAgICAgICAuc2V0KGhlYWRlcnMuYXV0aG9yaXphdGlvbilcbiAgICAgICAgICAgICAgLmV4cGVjdCgnQ29udGVudC1UeXBlJywgL2pzb24vKVxuICAgICAgICAgICAgICAuZXhwZWN0KDIwMClcbiAgICAgICAgICAgICAgLmVuZCgoZXJyLCByZXMpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyKSBkb25lKGVycik7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5KS50by5iZS5hbignb2JqZWN0Jyk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5KS50by5oYXZlLnByb3BlcnR5KCduYW1lJyk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5KS50by5oYXZlLnByb3BlcnR5KCd0aXRsZScpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChyZXMuYm9keSkudG8uaGF2ZS5wcm9wZXJ0eSgnZW1haWwnKTtcbiAgICAgICAgICAgICAgICBleHBlY3QocmVzLmJvZHkpLnRvLmhhdmUucHJvcGVydHkoJ3Bob25lJyk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5KS50by5oYXZlLnByb3BlcnR5KCdhZGRyZXNzJyk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5KS50by5oYXZlLnByb3BlcnR5KCdjb21wYW55Jyk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5KS50by5oYXZlLnByb3BlcnR5KCdfaWQnKS50by5lcXVhbChwZXJzb24uaWQpO1xuICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgIGRvbmUoZXJyKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJQT1NUICcvYXBpL2NvbnRhY3RzJ1wiLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBwb3N0IGFuZCBnZXQgcmVzcG9uc2Ugc3RhdHVzIDIwMCcsIChkb25lKSA9PiB7XG4gICAgICByZXF1ZXN0KGFwaSlcbiAgICAgICAgLnBvc3QoJy8nKVxuICAgICAgICAuc2V0KGhlYWRlcnMuYXV0aG9yaXphdGlvbilcbiAgICAgICAgLnNlbmQoY29udGFjdClcbiAgICAgICAgLmV4cGVjdCgyMDApXG4gICAgICAgIC5lbmQoKGVyciwgcmVzKSA9PiB7XG4gICAgICAgICAgaWYgKGVycikgZG9uZShlcnIpO1xuICAgICAgICAgIGV4cGVjdChyZXMuYm9keSkudG8uYmUuYW4oJ29iamVjdCcpO1xuICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgndXBsb2FkIGltYWdlJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBnZXQgc3RhdHVzIDIwMCByZXNwb25zZScsIChkb25lKSA9PiB7XG4gICAgICAgIHJlcXVlc3QoYXBpKVxuICAgICAgICAgIC5wb3N0KCcvdXBsb2FkJylcbiAgICAgICAgICAuc2V0KGhlYWRlcnMuYXV0aG9yaXphdGlvbilcbiAgICAgICAgICAuYXR0YWNoKCdhdmF0YXInLCAnL1VzZXJzL2FkaS9EZXNrdG9wL25vZGVqcy01MTIucG5nJylcbiAgICAgICAgICAuZW5kKChlcnIsIHJlcykgPT4ge1xuICAgICAgICAgICAgaWYgKGVycikgZG9uZShlcnIpO1xuICAgICAgICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvLmVxdWFsKDIwMCk7XG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJQVVQgJy9hcGkvY29udGFjdHMvOmlkJ1wiLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZXQgc3RhdHVzIDIwMCBpZiBBdXRob3JpemVkJywgKGRvbmUpID0+IHtcbiAgICAgIGNvbnN0IG5ld0NvbnRhY3QgPSBuZXcgQ29udGFjdChjb250YWN0KTtcbiAgICAgIGNvbnN0IHByb21pc2UgPSBuZXdDb250YWN0LnNhdmUoKTtcbiAgICAgIHByb21pc2UudGhlbigocGVyc29uKSA9PiB7XG4gICAgICAgIGlmIChwZXJzb24pIHtcbiAgICAgICAgICBjb25zdCBib2R5ID0ge307XG4gICAgICAgICAgYm9keS5uYW1lID0gJ0pob25ueSBEZXBwIHB1dCc7XG4gICAgICAgICAgYm9keS5jb21wYW55ID0gJ0hvbGx5d29vZCc7XG4gICAgICAgICAgYm9keS50aXRsZSA9ICdBY3RyZXNzJztcbiAgICAgICAgICBjb25zdCBuZXdQZXJzb24gPSBPYmplY3QuYXNzaWduKHBlcnNvbiwgYm9keSk7XG4gICAgICAgICAgcmVxdWVzdChhcGkpXG4gICAgICAgICAgICAucHV0KGAvJHtwZXJzb24uaWR9YClcbiAgICAgICAgICAgIC5zZXQoaGVhZGVycy5hdXRob3JpemF0aW9uKVxuICAgICAgICAgICAgLnNlbmQobmV3UGVyc29uKVxuICAgICAgICAgICAgLmV4cGVjdCgnQ29udGVudC1UeXBlJywgL2pzb24vKVxuICAgICAgICAgICAgLmV4cGVjdCgyMDApXG4gICAgICAgICAgICAuZW5kKChlcnIsIHJlcykgPT4ge1xuICAgICAgICAgICAgICBpZiAoZXJyKSBkb25lKGVycik7XG4gICAgICAgICAgICAgIGV4cGVjdChyZXMuYm9keSkudG8uYmUuYW4oJ29iamVjdCcpO1xuICAgICAgICAgICAgICBleHBlY3QocmVzLmJvZHkpLnRvLmhhdmUucHJvcGVydHkoJ25hbWUnKS50by5lcXVhbCgnSmhvbm55IERlcHAgcHV0Jyk7XG4gICAgICAgICAgICAgIGV4cGVjdChyZXMuYm9keSkudG8uaGF2ZS5wcm9wZXJ0eSgndGl0bGUnKTtcbiAgICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5KS50by5oYXZlLnByb3BlcnR5KCdlbWFpbCcpO1xuICAgICAgICAgICAgICBleHBlY3QocmVzLmJvZHkpLnRvLmhhdmUucHJvcGVydHkoJ3Bob25lJyk7XG4gICAgICAgICAgICAgIGV4cGVjdChyZXMuYm9keSkudG8uaGF2ZS5wcm9wZXJ0eSgnYWRkcmVzcycpO1xuICAgICAgICAgICAgICBleHBlY3QocmVzLmJvZHkpLnRvLmhhdmUucHJvcGVydHkoJ2NvbXBhbnknKTtcbiAgICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5KS50by5oYXZlLnByb3BlcnR5KCdfaWQnKS50by5lcXVhbChwZXJzb24uaWQpO1xuICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGRvbmUoZXJyKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIlBBVENIICcvYXBpL2NvbnRhY3RzLzppZCdcIiwgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2V0IHN0YXR1cyAyMDAgaWYgQXV0aG9yaXplZCcsIChkb25lKSA9PiB7XG4gICAgICBjb25zdCBuZXdDb250YWN0ID0gbmV3IENvbnRhY3QoY29udGFjdCk7XG4gICAgICBjb25zdCBwcm9taXNlID0gbmV3Q29udGFjdC5zYXZlKCk7XG4gICAgICBwcm9taXNlLnRoZW4oKHBlcnNvbikgPT4ge1xuICAgICAgICBpZiAocGVyc29uKSB7XG4gICAgICAgICAgY29uc3QgYm9keSA9IHt9O1xuICAgICAgICAgIGJvZHkuZmF2b3JpdGUgPSB0cnVlO1xuICAgICAgICAgIGJvZHkubmFtZSA9ICdwYXRjaCc7XG4gICAgICAgICAgY29uc3QgbmV3UGVyc29uID0gT2JqZWN0LmFzc2lnbihwZXJzb24sIGJvZHkpO1xuICAgICAgICAgIHJlcXVlc3QoYXBpKVxuICAgICAgICAgICAgLnBhdGNoKGAvJHtwZXJzb24uaWR9YClcbiAgICAgICAgICAgIC5zZXQoaGVhZGVycy5hdXRob3JpemF0aW9uKVxuICAgICAgICAgICAgLnNlbmQobmV3UGVyc29uKVxuICAgICAgICAgICAgLmV4cGVjdCgyMDApXG4gICAgICAgICAgICAuZW5kKChlcnIsIHJlcykgPT4ge1xuICAgICAgICAgICAgICBpZiAoZXJyKSBkb25lKGVycik7XG4gICAgICAgICAgICAgIGV4cGVjdChyZXMuYm9keSkudG8uYmUuYW4oJ29iamVjdCcpO1xuICAgICAgICAgICAgICBleHBlY3QocmVzLmJvZHkpLnRvLmhhdmUucHJvcGVydHkoJ25hbWUnKS50by5lcXVhbCgncGF0Y2gnKTtcbiAgICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5KS50by5oYXZlLnByb3BlcnR5KCdmYXZvcml0ZScpLnRvLmVxdWFsKHRydWUpO1xuICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGRvbmUoZXJyKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIkRFTEVURSAnL2FwaS9jb250YWN0cy86aWQnXCIsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGdldCBzdGF0dXMgMjAwIGlmIEF1dGhvcml6ZWQnLCAoZG9uZSkgPT4ge1xuICAgICAgY29uc3QgbmV3Q29udGFjdCA9IG5ldyBDb250YWN0KGNvbnRhY3QpO1xuICAgICAgY29uc3QgcHJvbWlzZSA9IG5ld0NvbnRhY3Quc2F2ZSgpO1xuICAgICAgcHJvbWlzZS50aGVuKChwZXJzb24pID0+IHtcbiAgICAgICAgaWYgKHBlcnNvbikge1xuICAgICAgICAgIHJlcXVlc3QoYXBpKVxuICAgICAgICAgICAgLmRlbGV0ZShgLyR7cGVyc29uLmlkfWApXG4gICAgICAgICAgICAuc2V0KGhlYWRlcnMuYXV0aG9yaXphdGlvbilcbiAgICAgICAgICAgIC5leHBlY3QoMjAwLCBkb25lKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGRvbmUoZXJyKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19